"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:true});exports.PostHogProvider=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _posthogRn=require("./posthog-rn");var _autocapture=require("./autocapture");var _useNavigationTracker=require("./hooks/useNavigationTracker");var _useLifecycleTracker=require("./hooks/useLifecycleTracker");var _PostHogContext=require("./PostHogContext");var _this=void 0,_jsxFileName="/home/runner/work/posthog-js-lite/posthog-js-lite/posthog-react-native/lib/posthog-react-native/src/PostHogProvider.js";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{"default":e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&{}.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n["default"]=e,t&&t.set(e,n),n;}function PostHogNavigationHook(_ref){var options=_ref.options,client=_ref.client;(0,_useNavigationTracker.useNavigationTracker)(options===null||options===void 0?void 0:options.navigation,client);return null;}function PostHogLifecycleHook(_ref2){var client=_ref2.client;(0,_useLifecycleTracker.useLifecycleTracker)(client);return null;}var PostHogProvider=exports.PostHogProvider=function PostHogProvider(_ref3){var children=_ref3.children,client=_ref3.client,options=_ref3.options,apiKey=_ref3.apiKey,autocapture=_ref3.autocapture,style=_ref3.style,_ref3$debug=_ref3.debug,debug=_ref3$debug===void 0?false:_ref3$debug;var _a,_b;if(!client&&!apiKey){throw new Error('Either a PostHog client or an apiKey is required. If want to use the PostHogProvider without a client, please provide an apiKey and the options={ disabled: true }.');}var posthog=(0,_react.useMemo)(function(){if(client&&apiKey){console.warn('You have provided both a client and an apiKey to PostHogProvider. The apiKey will be ignored in favour of the client.');}return client!==null&&client!==void 0?client:new _posthogRn.PostHog(apiKey!==null&&apiKey!==void 0?apiKey:'',options);},[client,apiKey]);var autocaptureOptions=(0,_react.useMemo)(function(){return autocapture&&typeof autocapture!=='boolean'?autocapture:{};},[autocapture]);var captureAll=autocapture===true;var captureNone=autocapture===false;var captureTouches=!captureNone&&posthog&&(captureAll||(autocaptureOptions===null||autocaptureOptions===void 0?void 0:autocaptureOptions.captureTouches));var captureScreens=!captureNone&&posthog&&(captureAll||((_a=autocaptureOptions===null||autocaptureOptions===void 0?void 0:autocaptureOptions.captureScreens)!==null&&_a!==void 0?_a:true));var captureLifecycle=!captureNone&&posthog&&(captureAll||((_b=autocaptureOptions===null||autocaptureOptions===void 0?void 0:autocaptureOptions.captureLifecycleEvents)!==null&&_b!==void 0?_b:true));var phLabelProp=(autocaptureOptions===null||autocaptureOptions===void 0?void 0:autocaptureOptions.customLabelProp)||_autocapture.defaultPostHogLabelProp;(0,_react.useEffect)(function(){posthog.debug(debug);},[debug,posthog]);var onTouch=(0,_react.useCallback)(function(type,e){if(!captureTouches){return;}if(type==='end'){(0,_autocapture.autocaptureFromTouchEvent)(e,posthog,autocaptureOptions);}},[captureTouches,posthog,autocaptureOptions]);return _react["default"].createElement(_reactNative.View,(0,_extends2["default"])({},(0,_defineProperty2["default"])({},phLabelProp,'PostHogProvider'),{style:style||{flex:1},onTouchEndCapture:captureTouches?function(e){return onTouch('end',e);}:undefined,__self:_this,__source:{fileName:_jsxFileName,lineNumber:48,columnNumber:13}}),_react["default"].createElement(_PostHogContext.PostHogContext.Provider,{value:{client:posthog},__self:_this,__source:{fileName:_jsxFileName,lineNumber:50,columnNumber:7}},_react["default"].createElement(_react["default"].Fragment,null,captureScreens?_react["default"].createElement(PostHogNavigationHook,{options:autocaptureOptions,client:posthog,__self:_this,__source:{fileName:_jsxFileName,lineNumber:52,columnNumber:29}}):null,captureLifecycle?_react["default"].createElement(PostHogLifecycleHook,{client:posthog,__self:_this,__source:{fileName:_jsxFileName,lineNumber:53,columnNumber:31}}):null),children));};